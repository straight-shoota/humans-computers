<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <title>Power of Crystal: A language for humans and computers</title>

  <link rel="stylesheet" href="dist/reset.css">
  <link rel="stylesheet" href="dist/reveal.css">
  <link rel="stylesheet" href="dist/theme/crystal.css">

  <!-- Theme used for syntax highlighted code -->
  <link rel="stylesheet" href="plugin/highlight/monokai.css">
</head>

<body>
  <div class="reveal">
    <div class="slides">
      <section>
        <section data-background-color="black" data-background-image="assets/pattern.svg">
          <hgroup>
            <h1>Crystal: A language for humans and computers</h1>
            <h2>Johannes Müller &ndash; Crystal Core Team / Manas.Tech</h2>
          </hgroup>
          <img src="assets/crystal.svg" style="width: 2em; margin-top: 1em; filter: invert();" />
        </section>

        <section>
          <h1>Agenda</h1>
          <ul>
            <li>Intro to Crystal</li>
            <li>Static ↔ Dynamic</li>
            <li>Batteries included</li>
            <li>Crystal ball</li>
          </ul>
          <aside class="notes">
            <ul>
              <li></li>
            </ul>
          </aside>
        </section>
      </section>

      <section data-background-color="black">
        <p>Johannes Müller</p>

        <p><a href="https://github.com/straight-shoota/">@straight-shoota</a></p>
        <p><a href="https://fosstodon.org/@straightshoota">@straightshoota@fosstodon.org</a></p>
        <p><a href="mailto:jmuller@manas.tech">jmuller@manas.tech</a></p>

        <hr>
        <p><a href="https://straight-shoota.github.io/humans-computers">straight-shoota.github.io/humans-computers</a>
        </p>
        <p>
          <a href="https://crystal-lang.org/install">crystal-lang.org/install</a> | <a
            href="https://play.crystal-lang.org">play.crystal-lang.org</a>
        </p>

        <aside class="notes">
          <ul>
            <li>I am Johannes Müller / straight-shoota.</li>
            <li>When I learned about compiler tech at university: nice to be aware of what goes on in the background,
              but I won't need that. There are already plenty languages out there and smart people building them</li>
            <li>And here I am, presenting a programming language</li>
            <li>When I learned Ruby, it was the first time I fell in love with a programming language (fun)</li>
            <li>Later discovered Crystal was the second time</li>
            <li>it expands on Ruby, adding some extra flavour that I find very attractive</li>
            <li>Crystal was still young, so lots of basics missing and I started contributing</li>
            <li>Eventually became a Core Team member</li>
            <li>now working on Crystal full time at Manas, the place were
              Crystal was born and continues stewardship of the project.</li>
            <li>I ended up as head of the project</li>
          </ul>
        </aside>
      </section>

      <section>
        <h2>Origin story</h2>
        <p>Manas.Tech<< /p>
            <a href="https://manas.tech/"><img src="assets/manas.svg" alt="Manas"
                style="width: 33%; aspect-ratio: 1;"></a>

            <aside class="notes">
              <ul>
                <li>Manas is a software agency from Argentina with an international team</li>
                <li>we built software for clients using lots of different technologies</li>
                <li>particularly Ruby (on Rails)</li>
                <li>While Ruby is great, some things are not so great: Type safety, performance, distribution,
                  concurrency
                </li>
                <li><strong>A programming language has a set of features and compromises</strong></li>
              </ul>
            </aside>
      </section>

      <section>
        <em>“What if we could evolve Ruby to compile statically?”</em>
        <p class="fragment">
          <code class="language-crystal">puts <span class="hljs-string">"Hello, Crystal!"</span></code>
        </p>

        <aside class="notes">
          <ul>
            <li>type safety is challenging. with compatibility and coherence of the ecosystem (modern approaches: RBS,
              Sorbet).</li>
            <li>Ruby 3 and JIT increased performance significantly.<br>But dynamic nature puts it still
              on a different level of efficiency compared to native code.</li>
            <li>Ruby requires the language runtime. It's hard to distribute software to non-developers.</li>
            <li>Writing concurrent software can be an adventure</li>
            <li><strong>Crystal started as experiment. Compiler originally written in Ruby. Grew into language and
                ecosystem.</strong></li>
          </ul>
        </aside>
      </section>

      <section>
        <h2>Crystal formula</h2>
        <ul>
          <li>Goodies from Ruby's lineage</li>
          <li>+ static typing with type inference</li>
          <li>+ highly efficient native code</li>
          <li>+ strong, intuitive concurrency model</li>
        </ul>

        <aside class="notes">
          <p>General description: object oriented, general purpose, garbage collected</p>
          <p>Crystal takes the best from Ruby and adds some more</p>
          <p>moves more to the static without loosing too much dynamic feel</p>
        </aside>
      </section>

      <section data-auto-animate>
        <h2>Static ↔ Dynamic</h2>
        <pre data-id="code-animation"><code class="language-crystal">def add(a, b)
  a + b
end

add 1, 2 # => 3
add "foo", "bar" # => "foobar"</code></pre>

        <aside class="notes">
          <ul>
            <li>a bit like function templates. statically typed, but feels dynamic through type inference</li>
            <li>Compiler realizes there are two instantiations of `#add`, one with both parameters being integers, one
              with both being string</li>
            <li>explicit typing is rarely necessary and in most places automatically inferred</li>
            <li>Note: We <em>could</em> add type information, and it's often helpful to establish invariants and
              document expectations in library APIs</li>
          </ul>
        </aside>
      </section>

      <section data-auto-animate>
        <h2>Static ↔ Dynamic</h2>
        <pre data-id="code-animation"><code class="language-crystal">def add(a, b)
  a + b
end

add 1, 2 # => 3
add "foo", "bar" # => "foobar"

add "foo", 2 # Error: instantiating 'add(String, Int32)
             # Error: expected argument #1 to 'String#+'
             # to be Char or String, not Int32
</code></pre>

        <aside class="notes">
          <ul>
            <li>In a truly dynamic typed language this would only error when the code executes</li>
            <li>In Crystal you get the error at compile time</li>
            <li>Piece of mind</li>
          </ul>
        </aside>
      </section>

      <section data-auto-animate data-auto-animate-restart>
        <h2>Static ↔ Dynamic</h2>

        <pre data-id="code-animation2"><code class="language-crystal">ary = [1, 2, 3]

ary.class # => Array(Int32)

ary << 4
typeof(ary[0]) # => Int32
</code></pre>

        <aside class="notes">
          <p>there is not a single <code>Array</code> class but different instantiations with generic parameterization
          </p>
        </aside>
      </section>

      <section>
        <section data-auto-animate>
          <h2>Metaprogramming: <code>macro</code></h2>
          <p>Code that writes other code at compile time</p>
          <div class="r-stack">
            <pre><code class="language-crystal">macro getter(var)
  @{{ var }}

  def {{ var.var }} : {{ var.type}}
    @{{ var.var.id }}
  end
end

getter foo : Int32 = 0
</code></pre>
          </div>
          <div>
            <p>Macro expansion:</p>
            <pre><code class="language-crystal">@def : Int32 = 0

def foo : Int32
  @foo
end
</code></pre>
          </div>

          <aside class="notes">
            <ul>
              <li><code>macro</code> has same structure as <code>def</code>, just different keyword</li>
              <li>simplified example from stdlib</li>
              <li>there's also hooks like <code>macro inherited</code></li>
            </ul>
          </aside>
        </section>
      </section>

      <section>
        <section>
          <h2>Batteries included</h2>
          <pre><code class="language-crystal"># A very basic HTTP server
require "http/server"

server = HTTP::Server.new do |context|
  context.response.content_type = "text/plain"
  context.response.print "Hello, Crystal!"
end

address = server.bind_tcp(8080)
puts "Listening on http://#{address}"

server.listen
</code></pre>

          <aside class="notes">
            <ul>
              <li><code>http/server</code> is part of Crystal's standard library (other JSON, XML, Crypto ...)</li>
              <li>Crystal comes with a lot of useful tools out of the box</li>
              <li>requests are handled in individual fibers, enabling concurrency (not that useful if you just print
                hello Crystalm but imagine bigger)</li>
              <li>the last call blocks until the process is terminated</li>
            </ul>
          </aside>
        </section>

        <section>
          <pre><code class="language-console" data-trim>
$ crystal build --release src/http-server.cr

$ ./http-server &

$ wrk -t8 -c400 -d60s http://localhost:8080/
Running 1m test @ http://localhost:8080/
  8 threads and 400 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency     7.11ms    1.09ms  17.66ms   79.34%
    Req/Sec     7.07k     1.15k   62.53k    85.64%
  3373196 requests in 1.00m, 334.56MB read
Requests/sec:  56126.81
Transfer/sec:      5.57MB
</code></pre>
          <aside class="notes">
            <ul>
              <li>uses only a single thread</li>
            </ul>
        </section>
      </section>

      <section>
        <h2>Concurrency</h2>
          <pre><code class="language-crystal">done = Channel(Int32).new

spawn do
  result = do_some_work
  done.send result
end

done.reveice
</code></pre>
        <aside class="notes">
          <ul>
            <li>lightweight threads</li>
            <li>communicating sequential processes (used also by Elixir and Go)</li>
            <li>all code is implicitly async (no colored functions, no callback hell)</li>
            <li>basically every time you need to wait on something (like reading from a socket), the scheduler
              just continues running another fiber and the current one wakes up when its ready to continue.</li>
          </ul>
        </aside>
      </section>

      <section>
        <h2>Crystal Ball</h2>

        <ul>
          <li>Execution Contexts</li>
          <li>Thread safety</li>
          <li>io_uring</li>
          <li>Windows</li>
        </ul>

        <aside class="notes">
          <ul>
            <li>multi-threading works as well, MT scheduler is currently in preview</li>
            <li>we've had basic experimental support for years and it's served in production</li>
            <li>Current focus: execution contexts</li>
            <li>Much work left to make stdlib and ecosystem thread safe</li>
          </ul>
        </aside>
      </section>

      <section>
        <ul>
          <li>Language introduction
            tutorial:<br>
            <a
              href="https://crystal-lang.org/reference/">crystal-lang.org/reference/</a>
          </li>
          <li>Excercism Track: <br><a href="https://exercism.org/tracks/Crystal">exercism.org/tracks/Crystal</a></li>
        </ul>
      </section>

      <section>
        <p><a href="https://crystal-lang.org">crystal-lang.org</a></p>
        <div style="display: flex; gap: 5%; justify-content: center;">
          <a href="https://crystal-lang.org" style="width: 20%; aspect-ratio: 1;"><img src="assets/crystal.svg"
              alt="Crystal" style="background: white; border-radius: 50%;"></a>
        </div>

        <p></p>
        <h2>Thank you</h2>
        <div style="display: flex; gap: 5%; justify-content: center;">

          <a href="https://84codes.com" style="width: 12%; aspect-ratio: 1;"><img src="assets/84codes.svg"
              alt="84codes"></a>

          <a href="https://manas.tech/" style="width: 12%; aspect-ratio: 1;"><img src="assets/manas.svg"
              style="width: 100%;" alt="Manas"></a>
        </div>
      </section>
    </div>
  </div>

  <script src="dist/reveal.js"></script>
  <script src="plugin/notes/notes.js"></script>
  <script src="plugin/markdown/markdown.js"></script>
  <script src="plugin/highlight/highlight.js"></script>
  <script>
    // More info about initialization & config:
    // - https://revealjs.com/initialization/
    // - https://revealjs.com/config/
    Reveal.initialize({
      hash: true,
      // totalTime: 1800,

      // Learn about plugins: https://revealjs.com/plugins/
      plugins: [RevealMarkdown, RevealHighlight, RevealNotes],

      slideNumber: "c/t",
      showSlideNumber: "speaker",
    });
  </script>
</body>

</html>
